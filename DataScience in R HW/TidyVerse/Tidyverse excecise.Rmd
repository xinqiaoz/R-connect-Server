---
title: "Tidyverse Exercise"
author: "Kerui Cao"
date: "10/1/2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F,warning = F,fig.height = 4)
pacman::p_load("tidyverse","knitr","kableExtra","gapminder","magrittr")
```
```{r}
da = gapminder
```

### How many continents are included in the data set?  

```{r}
Num_of_continent = da$continent %>% unique %>% length
```

\qquad So the numbers of countries is `r Num_of_continent`.  

### How many countrys are included? How many countries per continent?  

```{r}
Num_of_contries = da$country %>% unique %>% length
```

\qquad There are `r Num_of_contries` contries included. So `r Num_of_contries/Num_of_continent` contries per continents. More specific and accurate infomation is listed below"  
  

```{r echo=F}
con_per = da %>% group_by(continent) %>% summarise( Num_of_contries = country %>% unique %>% length) %>% arrange(Num_of_contries , continent)
```


```{r echo=F}
kable(con_per, caption = "Number of countries included for each cintinents", align = "c", booktab =T, format = "latex",longtable = T) %>% kable_styling(latex_options = "hold_position")
```

### Using the gapminder data, produce a report showing the continents in the dataset, total population per continent, and GDP per capita. Be sure that the table is properly labeled and suitable for inclusion in a printed report.  

```{r}
te = da %>% group_by(year,continent) %>% summarise(tol_POP = sum(as.numeric(pop)),GDP_perCap = sum(pop*gdpPercap)/tol_POP) %>% arrange(continent)
colnames(te)=c("Year","Continent","Total Population","GDP Per Capita")
ka1 = cbind(te[1:12,],te[13:24,],te[25:36,])
ka2 = cbind(te[37:48,],te[49:60,])

kable(ka1[,c(1,3,4,7,8,11,12)], caption = "Total Population and GDP per Capita", align = "c", booktab =T,format = "latex") %>% kable_styling(latex_options = c("HOLD_position","scale_down")) %>% add_header_above(c("Year"=1,"Africa"=2,"American"=2,"Asia"=2))
kable(ka2[,c(1,3,4,7,8)], caption = "Total Population and GDP per Capita", align = "c", booktab =T,format = "latex") %>% kable_styling(latex_options = c("HOLD_position")) %>% add_header_above(c("Year"=1,"Europe"=2,"Oceania"=2))
```

### Produce a well-labeled table that summarizes GDP per capita for the countries in each continent, contrasting the years 1952 and 2007.  

```{r warning=FALSE}
Summary_1952 = da %>% filter(year == 1952) %>% group_by(continent) %>% summarise(Ave_GDP_Capita = mean(gdpPercap), 
                                                                  Max_GDP_Capita = max(gdpPercap),
                                                                  Min_GDP_Capita = min(gdpPercap),
                                                                  var_GDP_Capita = var(gdpPercap)) %>% arrange(Ave_GDP_Capita)
kable(Summary_1952, caption = "Summary for GDP per Capita in 1952", align = "c", booktab =T, format = "latex") %>% 
  kable_styling(latex_options = c("HOLD_position"))
Summary_2007 = da %>% filter(year == 2007) %>% group_by(continent) %>% summarise(Ave_GDP_Capita = mean(gdpPercap), 
                                                                  Max_GDP_Capita = max(gdpPercap),
                                                                  Min_GDP_Capita = min(gdpPercap),
                                                                  var_GDP_Capita = var(gdpPercap)) %>% arrange(Ave_GDP_Capita)
kable(Summary_2007, caption = "Summary for GDP per Capita in 2007", align = "c", booktab =T, format = "latex") %>% 
  kable_styling(latex_options = c("HOLD_position","scale_down"))
```

### Product a plot that summarizes the same data as the table. There should be two plots per continent. 

\qquad Summary for year 1952  

```{r}
a1=ggplot(Summary_1952) +
 aes(x = continent, weight = Ave_GDP_Capita) +
 geom_bar(fill = "#0c4c8a") +
 labs(y = "Ave_GDP_Capita")


a2=ggplot(Summary_1952) +
 aes(x = continent, weight = Max_GDP_Capita) +
 geom_bar(fill = "#0c4c8a") +
 labs(y = "Max_GDP_Capita")

a3=ggplot(Summary_1952) +
 aes(x = continent, weight = Min_GDP_Capita) +
 geom_bar(fill = "#0c4c8a") +
 labs(y = "Min_GDP_Capita")

a4=ggplot(Summary_1952) +
 aes(x = continent, weight = var_GDP_Capita) +
 geom_bar(fill = "#0c4c8a") +
 labs(y = "Variance_GDP_Capita")
gridExtra::grid.arrange(a1,a2,a3,a4,ncol=2)
```

\qquad Summary for year 2007  

```{r}
a1=ggplot(Summary_2007) +
 aes(x = continent, weight = Ave_GDP_Capita) +
 geom_bar(fill = "#0c4c8a") +
 labs(y = "Ave_GDP_Capita")


a2=ggplot(Summary_2007) +
 aes(x = continent, weight = Max_GDP_Capita) +
 geom_bar(fill = "#0c4c8a") +
 labs(y = "Max_GDP_Capita")

a3=ggplot(Summary_2007) +
 aes(x = continent, weight = Min_GDP_Capita) +
 geom_bar(fill = "#0c4c8a") +
 labs(y = "Min_GDP_Capita")

a4=ggplot(Summary_2007) +
 aes(x = continent, weight = var_GDP_Capita) +
 geom_bar(fill = "#0c4c8a") +
 labs(y = "Variance_GDP_Capita")
gridExtra::grid.arrange(a1,a2,a3,a4,ncol=2)

```

### Which countries in the dataset have had periods of negative population growth? Illustrate your answer with a table or plot.  

```{r}
neg_inc =  da %>% group_by(country) %>% summarise(t = sum(diff(pop)>0), l = length(pop), n = 11-t) %>% filter(t<11) %>% arrange(n)
colnames(neg_inc) = c("Country","","","# of year of negative pop growth")
neg_inc = cbind(neg_inc[1:9,],neg_inc[10:18,],neg_inc[19:27,])
kable(neg_inc[,c(1,4,5,8,9,12)], caption = "Countries had periods of negative population growth", align = "c", booktab =T, format = "latex") %>%
  kable_styling(latex_options = c("HOLD_position")) %>% column_spec(c(1,2,3,4,5,6),width = "7em")
```

### Which countries in the dataset have had the highest rate of growth in per capita GDP? Illustrate your answer with a table or plot.

```{r}
da$'Log_gdpC' = log(da$gdpPercap)
tt = da %>% group_by(country) %>% summarise(Max_GR = max(diff(Log_gdpC))) %>% arrange(desc(Max_GR))
kable(tt[1:10,],format = "latex",booktab=T,align = "c",caption = "Log Growth Rate") %>% kable_styling(latex_options = "HOLD_position")
```

