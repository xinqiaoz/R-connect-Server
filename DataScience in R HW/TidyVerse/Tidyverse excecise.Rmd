---
title: "Tidyverse Exercise"
author: "Kerui Cao"
date: "10/1/2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F,warning = F)
pacman::p_load("tidyverse","knitr","kableExtra","gapminder","magrittr")
```
```{r}
da = gapminder
```

### How many continents are included in the data set?  

```{r}
Num_of_continent = da$continent %>% unique %>% length
```

\qquad So the numbers of countries is `r Num_of_continent`.  

### How many countrys are included? How many countries per continent?  

```{r}
Num_of_contries = da$country %>% unique %>% length
```

\qquad There are `r Num_of_contries` contries included. So `r Num_of_contries/Num_of_continent` contries per continents. More specific and accurate infomation is listed below"  
  

```{r echo=F}
con_per = da %>% group_by(continent) %>% summarise( Num_of_contries = country %>% unique %>% length) %>% arrange(Num_of_contries , continent)
```


```{r echo=F}
kable(con_per, caption = "Number of countries included for each cintinents", align = "c", booktab =T, format = "latex",longtable = T) %>% kable_styling(latex_options = "hold_position")
```

### Using the gapminder data, produce a report showing the continents in the dataset, total population per continent, and GDP per capita. Be sure that the table is properly labeled and suitable for inclusion in a printed report.  

```{r}
da %<>% mutate(total_GDP = round(pop*gdpPercap/(10^9),2))
```
```{r}
GDP = NULL
for (i in unique(da$year)) {
  te = da %>% filter(year == i) %>% group_by(continent) %>% summarise(tol_GDP = round(sum(total_GDP),2)) %>% arrange(tol_GDP,continent)
  GDP = cbind(GDP,as.matrix(te)) 
}

kable(GDP[,1:8], caption = "Total GDP for each continents 1952-1967", align = "c", booktab =T, format = "latex",longtable = F) %>% kable_styling(latex_options = c("HOLD_position")) %>% add_header_above(c("1952"=2,"1957"=2,
                                                                         "1962"=2,"1967"=2))
kable(GDP[,9:16], caption = "Total GDP for each continents 1972-1987", align = "c", booktab =T, format = "latex",longtable = F) %>% kable_styling(latex_options = c("HOLD_position")) %>% add_header_above(c("1972"=2,"1977"=2,
                                                                         "1982"=2,"1987"=2))
kable(GDP[,17:24], caption = "Total GDP for each continents 1992-2007", align = "c", booktab =T, format = "latex",longtable = F) %>% kable_styling(latex_options = c("HOLD_position")) %>% add_header_above(c("1992"=2,"1997"=2,
                                                                         "2002"=2,"2007"=2))
```

### Produce a well-labeled table that summarizes GDP per capita for the countries in each continent, contrasting the years 1952 and 2007.  

```{r}
Summary_1952 = da %>% filter(year == 1952) %>% group_by(continent) %>% summarise(Ave_GDP_Capita = mean(gdpPercap), 
                                                                  Max_GDP_Capita = max(gdpPercap),
                                                                  Min_GDP_Capita = min(gdpPercap),
                                                                  var_GDP_Capita = var(gdpPercap)) %>% arrange(Ave_GDP_Capita)
kable(Summary_1952, caption = "Summary for GDP per Capita in 1952", align = "c", booktab =T, format = "latex") %>% 
  kable_styling(latex_options = c("HOLD_position"))
Summary_2007 = da %>% filter(year == 2007) %>% group_by(continent) %>% summarise(Ave_GDP_Capita = mean(gdpPercap), 
                                                                  Max_GDP_Capita = max(gdpPercap),
                                                                  Min_GDP_Capita = min(gdpPercap),
                                                                  var_GDP_Capita = var(gdpPercap)) %>% arrange(Ave_GDP_Capita)
kable(Summary_2007, caption = "Summary for GDP per Capita in 2007", align = "c", booktab =T, format = "latex") %>% 
  kable_styling(latex_options = c("HOLD_position"))
```

### Product a plot that summarizes the same data as the table. There should be two plots per continent. 

```{r}
print("To be asked")
```

### Which countries in the dataset have had periods of negative population growth? Illustrate your answer with a table or plot.  

```{r}
neg_inc =  da %>% group_by(country) %>% summarise(t = prod(diff(pop))<0) %>% filter(t) %>% arrange(country)
neg_inc = cbind(neg_inc[1:5,],neg_inc[6:10,],neg_inc[11:15,],neg_inc[16:20,])
colnames(neg_inc) = NULL
kable(neg_inc[,c(1,3,5,7)], caption = "Countries had periods of negative population growth", align = "c", booktab =T, format = "latex") %>% 
  kable_styling(latex_options = c("HOLD_position"))
```

### Which countries in the dataset have had the highest rate of growth in per capita GDP? Illustrate your answer with a table or plot.

```{r}
GDP_gr = 
```